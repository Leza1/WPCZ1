# ğŸš€ WPCZ1 - Water Pump Controller Zigbee 1
WPCZ1 lÃ  báº£n mod chuyá»ƒn Ä‘á»•i cÃ¡c cÃ´ng táº¯c Zigbee cÃ³ sáºµn trÃªn thá»‹ trÆ°á»ng thÃ nh bá»™ Ä‘iá»u khiá»ƒn bÆ¡m nÆ°á»›c (sá»­ dá»¥ng phao Ä‘iá»‡n) trong cÃ¡c há»™ gia Ä‘Ã¬nh táº¡i Viá»‡t Nam.

<div align="center">
  <img src="./images/wpcz1.svg" alt="wpcz1" width="400"/>
</div>

PhiÃªn báº£n Ä‘áº§u tiÃªn nÃ y há»— trá»£ cÃ¡c cÃ´ng táº¯c Xiaomi Aqara QBKG11LM (cÃ´ng táº¯c Ä‘Æ¡n) vÃ  QBKG12LM (cÃ´ng táº¯c Ä‘Ã´i), cÃ³ ná»‘i dÃ¢y trung tÃ­nh.

## âœ¨ TÃ­nh nÄƒng
- Äiá»u khiá»ƒn bÆ¡m nÆ°á»›c báº±ng phao Ä‘iá»‡n nhÆ° truyá»n thá»‘ng, Ä‘á»“ng thá»i bá»• sung kháº£ nÄƒng báº­t / táº¯t bÆ¡m thá»§ cÃ´ng thÃ´ng qua nÃºt nháº¥n trÃªn bá»™ Ä‘iá»u khiá»ƒn.
- Há»— trá»£ Ä‘iá»u khiá»ƒn tá»« xa thÃ´ng qua cÃ¡c á»©ng dá»¥ng nhÃ  thÃ´ng minh.
- Hiá»ƒn thá»‹ cÃ¡c thÃ´ng sá»‘ nhÆ° cÃ´ng suáº¥t, Ä‘iá»‡n Ã¡p, dÃ²ng Ä‘iá»‡n, sá»‘ láº§n báº­t / táº¯t,... giÃºp dá»… dÃ ng giÃ¡m sÃ¡t hoáº¡t Ä‘á»™ng cá»§a bÆ¡m vÃ  phÃ¡t hiá»‡n cÃ¡c báº¥t thÆ°á»ng (quÃ¡ táº£i, quÃ¡ nhiá»‡t, rÃ² rá»‰ nÆ°á»›c gÃ¢y báº­t / táº¯t liÃªn tá»¥c,...).
- TÃ­ch há»£p chá»©c nÄƒng báº£o vá»‡ quÃ¡ nhiá»‡t (trÃªn 55Â°C) vÃ  quÃ¡ táº£i (trÃªn 2000W).
- Äiá»u khiá»ƒn Ä‘Ã³ng / ngáº¯t bÆ¡m táº¡i Ä‘iá»ƒm Ä‘iá»‡n Ã¡p xáº¥p xá»‰ 0V nháº±m giáº£m hiá»‡n tÆ°á»£ng tia lá»­a Ä‘iá»‡n, giÃºp tÄƒng tuá»•i thá» cho rÆ¡ le.

## ğŸ“¸ áº¢nh chá»¥p mÃ n hÃ¬nh
![Screenshot](./images/screenshot1.png)

## âš™ï¸ HÆ°á»›ng dáº«n
### ğŸ›  Thay Ä‘á»•i pháº§n cá»©ng
âš ï¸ **Cáº£nh bÃ¡o an toÃ n**
- âš ï¸ Pháº§n thao tÃ¡c nÃ y **chá»‰ nÃªn Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi ngÆ°á»i cÃ³ chuyÃªn mÃ´n vá» Ä‘iá»‡n hoáº·c Ä‘iá»‡n tá»­**. Viá»‡c láº¯p Ä‘áº·t hoáº·c sá»­a Ä‘á»•i sai cÃ¡ch cÃ³ thá»ƒ gÃ¢y **nguy hiá»ƒm Ä‘áº¿n tÃ­nh máº¡ng**, cÅ©ng nhÆ° **gÃ¢y chÃ¡y ná»• thiáº¿t bá»‹.**
- âš ï¸ **KhÃ´ng nÃªn tá»± thá»±c hiá»‡n náº¿u báº¡n khÃ´ng cÃ³ chuyÃªn mÃ´n** - hÃ£y **nhá» ká»¹ thuáº­t viÃªn chuyÃªn nghiá»‡p** hoáº·c **sá»­ dá»¥ng thiáº¿t bá»‹ Ä‘Ã£ Ä‘Æ°á»£c mod sáºµn** Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n.

Xiaomi Aqara QBKG11LM vÃ  QBKG12LM dÃ¹ng chung PCB (mÃ£ LM15-LNS-PA-A-T0), chá»‰ khÃ¡c nhau sá»‘ lÆ°á»£ng nÃºt nháº¥n vÃ  rá» le bÃªn trong.
- QBKG11LM: CÃ³ má»™t nÃºt nháº¥n Ä‘iá»u khiá»ƒn má»™t rÆ¡ le ngÃµ ra.
- QBKG12LM: ÄÆ°á»£c hÃ n thÃªm linh kiá»‡n Ä‘á»ƒ má»Ÿ rá»™ng thÃ nh hai nÃºt nháº¥n, Ä‘iá»u khiá»ƒn hai rÆ¡ le ngÃµ ra.

âœ³ï¸ WPCZ1 sá»­ dá»¥ng **nÃºt nháº¥n bÃªn trÃ¡i** Ä‘á»ƒ káº¿t ná»‘i vá»›i **phao Ä‘iá»‡n**, vÃ  **nÃºt nháº¥n bÃªn pháº£i** Ä‘á»ƒ **báº­t / táº¯t bÆ¡m thá»§ cÃ´ng táº¡i chá»—**.
- QBKG11LM:
  - Cáº§n **hÃ n thÃªm Ä‘iá»‡n trá»Ÿ R2 4K7 (SMD 0402)** vÃ  **tá»¥ Ä‘iá»‡n C2 100nF (SMD 0402).**
  - HÃ n **dÃ¢y káº¿t ná»‘i phao Ä‘iá»‡n** vÃ o **nÃºt nháº¥n S1 bÃªn trÃ¡i.**
  - Xem [hÃ¬nh áº£nh chi tiáº¿t](QBKG11LM_modify.md)
  ![QBKG11LM](./images/QBKG11LM_modify.png)
- QBKG12LM:
  - **ThÃ¡o bá» nÃºt nháº¥n bÃªn trÃ¡i** Ä‘á»ƒ dÃ¹ng cho phao Ä‘iá»‡n.
  - NÃªn **thay Ä‘iá»‡n trá»Ÿ cÃ³ sáºµn R2 100K (SMD 0402)** báº±ng **4K7 (SMD 0402)** nháº±m tÄƒng Ä‘á»™ nháº¡y cho phao Ä‘iá»‡n Ä‘áº·t xa.
  - HÃ n **dÃ¢y káº¿t ná»‘i phao Ä‘iá»‡n** vÃ o **nÃºt nháº¥n S1 bÃªn trÃ¡i.**

### ğŸ”Œ Äáº¥u ná»‘i dÃ¢y Ä‘iá»‡n
![Wiring Connection](./images/Wiring-connection.png)

### ğŸ§© TÃ­ch há»£p vá»›i Zigbee2MQTT
Khi vá»«a tham gia máº¡ng, Zigbee2MQTT sáº½ liá»‡t kÃª **WPCZ1** lÃ  **thiáº¿t bá»‹ chÆ°a Ä‘Æ°á»£c há»— trá»£**, vÃ  **khÃ´ng hiá»ƒn thá»‹ báº¥t ká»³ tÃ­nh nÄƒng nÃ o.**

Äá»ƒ tÃ­ch há»£p WPCZ1 vÃ o Zigbee2MQTT, thá»±c hiá»‡n theo cÃ¡c bÆ°á»›c sau:
- Sao chÃ©p file [wpcz1.js](./z2m/wpcz1.js) vÃ o thÆ° má»¥c: `zigbee2mqtt/data/external_converters`
- ThÃªm cáº¥u hÃ¬nh sau vÃ o tá»‡p `configuration.yaml`:
```yaml
external_converters:
  - wpcz1.js
```
- Sau khi khá»Ÿi Ä‘á»™ng láº¡i Zigbee2MQTT, **cÃ¡c tÃ­nh nÄƒng cá»§a WPCZ1 sáº½ Ä‘Æ°á»£c hiá»ƒn thá»‹ vÃ  há»— trá»£ Ä‘áº§y Ä‘á»§.**

### ğŸ“¦ Cáº­p nháº­t firmware (OTA)
TODO:OTA

### ğŸ“– Sá»­ dá»¥ng

### ğŸš¨ Tráº¡ng thÃ¡i Ä‘Ã¨n LED
| ÄÃ¨n bÃ¡o                      | Tráº¡ng thÃ¡i thiáº¿t bá»‹                   |
|------------------------------|---------------------------------------|
| ÄÃ¨n xanh sÃ¡ng / táº¯t          | Báº­t / táº¯t bÆ¡m nÆ°á»›c                    |
| ÄÃ¨n xanh nháº¥p nhÃ¡y liÃªn tá»¥c  | Äang káº¿t ná»‘i máº¡ng                     |
| ÄÃ¨n Ä‘á» nháº¥p nhÃ¡y ngáº¯t quÃ£ng  | Thiáº¿t bá»‹ khÃ´ng Ä‘Æ°á»£c káº¿t ná»‘i máº¡ng      |
| ÄÃ¨n Ä‘á» nháº¥p nhÃ¡y liÃªn tá»¥c    | BÃ¡o Ä‘á»™ng quÃ¡ nhiá»‡t                    |
| ÄÃ¨n cam nháº¥p nhÃ¡y liÃªn tá»¥c   | BÃ¡o Ä‘á»™ng quÃ¡ táº£i                      |

## ğŸ“„ Giáº¥y phÃ©p
Dá»± Ã¡n nÃ y Ä‘Æ°á»£c cáº¥p phÃ©p theo Giáº¥y phÃ©p MIT â€“ xem tá»‡p [LICENSE](LICENSE) Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t.